{% extends "base.html" %}
{% block title %}{{ 'Edit' if group else 'New' }} Group â€” SSHADmin{% endblock %}
{% block page_title %}{{ 'Edit Group: ' + group.name if group else 'New Group' }}{% endblock %}

{% block content %}
<div class="max-w-2xl">
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <form method="POST">
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Group Name</label>
                    <input type="text" name="name" value="{{ group.name if group else '' }}" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Description</label>
                    <input type="text" name="description" value="{{ group.description if group else '' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Optional description">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">SSH Policy</label>
                    <div class="flex items-center gap-6">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="pubkey_auth" value="1"
                                   {{ 'checked' if not group or group.pubkey_auth else '' }}
                                   class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">PubKey Authentication</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="password_auth" value="1"
                                   {{ 'checked' if group and group.password_auth else '' }}
                                   class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Password Authentication</span>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Servers</label>
                    <div class="border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto space-y-2">
                        {% for server in all_servers %}
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="servers" value="{{ server.id }}"
                                   {{ 'checked' if group and server in group.servers else '' }}
                                   class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">{{ server.hostname }}</span>
                            <span class="text-xs text-gray-400">({{ server.ip_address }})</span>
                        </label>
                        {% else %}
                        <p class="text-sm text-gray-500">No servers registered yet.</p>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1.5">Users</label>
                    <div class="border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto space-y-2">
                        {% for user in all_users %}
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="users" value="{{ user.id }}"
                                   {{ 'checked' if group and user in group.users else '' }}
                                   class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">{{ user.username }}</span>
                            {% if user.is_blocked %}
                            <span class="text-xs text-red-500">(blocked)</span>
                            {% endif %}
                        </label>
                        {% else %}
                        <p class="text-sm text-gray-500">No users created yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-3 mt-8 pt-6 border-t border-gray-200">
                <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
                    {{ 'Save Changes' if group else 'Create Group' }}
                </button>
                <a href="{{ url_for('views.groups') }}"
                   class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
